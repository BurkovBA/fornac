!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.rnaplot=t():e.rnaplot=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={exports:{},id:r,loaded:!1};return e[r].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(11)},function(e,t,n){"use strict";function r(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)});return t}function a(e,t,n){var a=this;a.type="protein",a.size=t,a.nodes=[{name:"P",num:1,radius:3*Math.sqrt(t),rna:a,nodeType:"protein",structName:e,elemType:"p",size:t,uid:r()}],a.links=[],a.uid=r(),a.addUids=function(e){for(var t=0;t<e.length;t++)a.nodes[t].uid=e[t];return a},a.getUids=function(){uids=[];for(var e=0;e<a.dotbracket.length;e++)uids.push(a.nodes[e].uid);return uids}}function o(e,t,n,a){var o=this;o.type="rna",o.circularizeExternal=!1,0===arguments.length?(o.seq="",o.dotbracket="",o.structName=""):(o.seq=e,o.dotbracket=t,o.structName=n),arguments.length<4&&(a=1),o.circular=!1,o.dotbracket.length>0&&"*"==o.dotbracket[o.dotbracket.length-1]&&(o.dotbracket=o.dotbracket.slice(0,o.dotbracket.length-1),o.circular=!0),o.uid=r(),o.elements=[],o.pseudoknotPairs=[],o.nucsToNodes={},o.addUids=function(e){for(var t=o.nodes.filter(function(e){return"nucleotide"==e.nodeType}),n=0;n<e.length&&n<t.length;n++)t[n].uid=e[n];return o},o.computePairtable=function(){o.pairtable=s.rnaUtilities.dotbracketToPairtable(o.dotbracket)},o.removeBreaks=function(e){for(var t=[],n=-1;(n=e.indexOf("&"))>=0;)t.push(n),e=e.substring(0,n)+"oo"+e.substring(n+1,e.length);return{targetString:e,breaks:t}};var l=o.removeBreaks(o.dotbracket);o.dotbracket=l.targetString,o.dotBracketBreaks=l.breaks,l=o.removeBreaks(o.seq),o.seq=l.targetString,o.seqBreaks=l.breaks,o.calculateStartNumberArray=function(){o.startNumberArray=[];for(var e=0;e<o.dotbracket.length;e++)o.startNumberArray.push(a),"o"==o.dotbracket[e]&&(a=-e)},o.calculateStartNumberArray(),o.rnaLength=o.dotbracket.length,(0,s.arraysEqual)(o.dotBracketBreaks,o.seqBreaks)||(console.log("WARNING: Sequence and structure breaks not equal"),console.log("WARNING: Using the breaks in the structure")),o.computePairtable(),o.addPositions=function(e,t){for(var n=o.nodes.filter(function(t){return t.nodeType==e}),r=0;r<n.length;r++)n[r].x=t[r][0],n[r].px=t[r][0],n[r].y=t[r][1],n[r].py=t[r][1];return o},o.breakNodesToFakeNodes=function(){for(var e=o.nodes.filter(function(e){return"nucleotide"==e.nodeType}),t=0;t<e.length;t++)"o"==o.dotbracket[t]&&(e[t].nodeType="middle");for(var t=0;t<o.elements.length;t++){for(var n=!1,r=0;r<o.elements[t][2].length;r++)o.dotBracketBreaks.indexOf(o.elements[t][2][r])>=0&&(n=!0);n?o.elements[t][2].map(function(e){0!=e&&(o.nodes[e-1].elemType="e")}):o.elements[t][2].map(function(e){0!=e&&(o.nodes[e-1].elemType=o.elements[t][0])})}return o},o.getPositions=function(e){for(var t=[],n=o.nodes.filter(function(t){return t.nodeType==e}),r=0;r<n.length;r++)t.push([n[r].x,n[r].y]);return t},o.getUids=function(){for(var e=[],t=0;t<o.dotbracket.length;t++)e.push(o.nodes[t].uid);return e},o.reinforceStems=function(){for(var e=o.pairtable,t=o.elements.filter(function(e){return"s"==e[0]&&e[2].length>=4}),n=0;n<t.length;n++)for(var r=t[n][2],a=r.slice(0,r.length/2),l=0;l<a.length-1;l++)o.addFakeNode([a[l],a[l+1],e[a[l+1]],e[a[l]]]);return o},o.reinforceLoops=function(){for(var e=function(e){return 0!==e&&e<=o.dotbracket.length},t=0;t<o.elements.length;t++)if("s"!=o.elements[t][0]&&(o.circularizeExternal||"e"!=o.elements[t][0])){var n=o.elements[t][2].filter(e);if("e"==o.elements[t][0]){var a={name:"",num:-3,radius:0,rna:o,nodeType:"middle",elemType:"f",nucs:[],x:o.nodes[o.rnaLength-1].x,y:o.nodes[o.rnaLength-1].y,px:o.nodes[o.rnaLength-1].px,py:o.nodes[o.rnaLength-1].py,uid:r()},l={name:"",num:-2,radius:0,rna:o,nodeType:"middle",elemType:"f",nucs:[],x:o.nodes[0].x,y:o.nodes[0].y,px:o.nodes[0].px,py:o.nodes[0].py,uid:r()};n.push(o.nodes.length+1),n.push(o.nodes.length+2),o.nodes.push(a),o.nodes.push(l)}o.addFakeNode(n)}return o},o.updateLinkUids=function(){for(var e=0;e<o.links.length;e++)o.links[e].uid=o.links[e].source.uid+o.links[e].target.uid;return o},o.addFakeNode=function(e){for(var t=18,n=6.283/(2*e.length),a=t/(2*Math.tan(n)),l="",s=0;s<e.length;s++)l+=o.nodes[e[s]-1].uid;var i={name:"",num:-1,radius:a,rna:o,nodeType:"middle",elemType:"f",nucs:e,uid:l};o.nodes.push(i);var u=0,c=0,d=0;n=3.14159*(e.length-2)/(2*e.length),a=.5/Math.cos(n);for(var p=0;p<e.length;p++)if(!(0===e[p]||e[p]>o.dotbracket.length)){o.links.push({source:o.nodes[e[p]-1],target:o.nodes[o.nodes.length-1],linkType:"fake",value:a,uid:r()}),e.length>4&&o.links.push({source:o.nodes[e[p]-1],target:o.nodes[e[(p+Math.floor(e.length/2))%e.length]-1],linkType:"fake",value:2*a,uid:r()});var f=3.14159*(e.length-2)/e.length,h=2*Math.cos(1.570795-f/2);o.links.push({source:o.nodes[e[p]-1],target:o.nodes[e[(p+2)%e.length]-1],linkType:"fake",value:h});var g=o.nodes[e[p]-1];"x"in g&&(u+=g.x,c+=g.y,d+=1)}return d>0&&(i.x=u/d,i.y=c/d,i.px=i.x,i.py=i.y),o},o.connectFakeNodes=function(){for(var e=18,t=function(e){return"middle"==e.nodeType},n={},r=o.nodes.filter(t),a=new Set,l=1;l<=o.nodes.length;l++)n[l]=[];for(var l=0;l<r.length;l++)for(var s=r[l],i=0;i<s.nucs.length;i++){for(var u=s.nucs[i],c=0;c<n[u].length;c++)if(!a.has(JSON.stringify([n[u][c].uid,s.uid].sort()))){var d=n[u][c].radius+s.radius;o.links.push({source:n[u][c],target:s,value:d/e,linkType:"fake_fake"}),a.add(JSON.stringify([n[u][c].uid,s.uid].sort()))}n[u].push(s)}return o},o.addExtraLinks=function(e){if("undefined"==typeof e)return o;for(var t=0;t<e.length;t++){var n=o.getNodeFromNucleotides(e[t].from),a=o.getNodeFromNucleotides(e[t].to),l={source:n,target:a,linkType:"extra",extraLinkType:e[t].linkType,uid:r()};o.links.push(l)}return o},o.elementsToJson=function(){var e=o.pairtable;o.elements;o.nodes=[],o.links=[];var t={};o.elements.sort();for(var n=0;n<o.elements.length;n++)for(var a=o.elements[n][2],l=0;l<a.length;l++)t[a[l]]=o.elements[n][0];for(var n=1;n<=e[0];n++){var s=o.seq[n-1];(o.dotBracketBreaks.indexOf(n-1)>=0||o.dotBracketBreaks.indexOf(n-2)>=0)&&(s=""),o.nodes.push({name:s,num:n+o.startNumberArray[n-1]-1,radius:5,rna:o,nodeType:"nucleotide",structName:o.structName,elemType:t[n],uid:r(),linked:!1})}for(var n=0;n<o.nodes.length;n++)0===n?o.nodes[n].prevNode=null:o.nodes[n].prevNode=o.nodes[n-1],n==o.nodes.length-1?o.nodes[n].nextNode=null:o.nodes[n].nextNode=o.nodes[n+1];for(var n=1;n<=e[0];n++)0!==e[n]&&o.links.push({source:o.nodes[n-1],target:o.nodes[e[n]-1],linkType:"basepair",value:1,uid:r()}),n>1&&o.dotBracketBreaks.indexOf(n-1)===-1&&o.dotBracketBreaks.indexOf(n-2)==-1&&o.dotBracketBreaks.indexOf(n-3)==-1&&(o.links.push({source:o.nodes[n-2],target:o.nodes[n-1],linkType:"backbone",value:1,uid:r()}),o.nodes[n-1].linked=!0);for(var n=0;n<o.pseudoknotPairs.length;n++)o.links.push({source:o.nodes[o.pseudoknotPairs[n][0]-1],target:o.nodes[o.pseudoknotPairs[n][1]-1],linkType:"pseudoknot",value:1,uid:r()});return o.circular&&o.links.push({source:o.nodes[0],target:o.nodes[o.rnaLength-1],linkType:"backbone",value:1,uid:r()}),o},o.ptToElements=function(e,t,n,r){var a=[],l=[n-1],s=[r+1];if(n>r)return[];for(;0===e[n];n++)l.push(n);for(;0===e[r];r--)s.push(r);if(n>r){if(l.push(n),0===t)return[["e",t,l.sort(i)]];for(var u=!1,c=[],d=[],p=0;p<l.length;p++)u?d.push(l[p]):c.push(l[p]),o.dotBracketBreaks.indexOf(l[p])>=0&&(u=!0);return u?[["h",t,l.sort(i)]]:[["h",t,l.sort(i)]]}if(e[n]!=r){var f=l,p=n;for(f.push(p);p<=r;){for(a=a.concat(o.ptToElements(e,t,p,e[p])),f.push(e[p]),p=e[p]+1;0===e[p]&&p<=r;p++)f.push(p);f.push(p)}return f.pop(),f=f.concat(s),f.length>0&&(0===t?a.push(["e",t,f.sort(i)]):a.push(["m",t,f.sort(i)])),a}if(e[n]===r){l.push(n),s.push(r);var h=l.concat(s);h.length>4&&(0===t?a.push(["e",t,l.concat(s).sort(i)]):a.push(["i",t,l.concat(s).sort(i)]))}for(var g=[];e[n]===r&&n<r;)g.push(n),g.push(r),n+=1,r-=1,t+=1;return l=[n-1],s=[r+1],a.push(["s",t,g.sort(i)]),a.concat(o.ptToElements(e,t,n,r))},o.addLabels=function(e,t){if(0===arguments.length&&(e=1,t=10),1===arguments.length&&(t=10),0===t)return o;t<=0&&console.log("The label interval entered in invalid:",t);for(var n=1;n<=o.pairtable[0];n++)if(n%t===0){var a,l,s,i,u,c,d=o.nodes[n-1];1==o.rnaLength?(c=[d.x-15,d.y],u=[d.x-15,d.y]):(s=1==n?o.nodes[o.rnaLength-1]:o.nodes[n-2],i=n==o.rnaLength?o.nodes[0]:o.nodes[n],0!==o.pairtable[i.num]&&0!==o.pairtable[s.num]&&0!==o.pairtable[d.num]&&(s=i=o.nodes[o.pairtable[d.num]-1]),0===o.pairtable[d.num]||0!==o.pairtable[i.num]&&0!==o.pairtable[s.num]?(c=[i.x-d.x,i.y-d.y],u=[s.x-d.x,s.y-d.y]):(c=[d.x-i.x,d.y-i.y],u=[d.x-s.x,d.y-s.y]));var p=[c[0]+u[0],c[1]+u[1]],f=Math.sqrt(p[0]*p[0]+p[1]*p[1]),h=[p[0]/f,p[1]/f],g=[-15*h[0],-15*h[1]],a=o.nodes[n-1].x+g[0],l=o.nodes[n-1].y+g[1],k={name:n+o.startNumberArray[n-1]-1,num:-1,radius:6,rna:o,nodeType:"label",structName:o.structName,elemType:"l",x:a,y:l,px:a,py:l,uid:r()},m={source:o.nodes[n-1],target:k,value:1,linkType:"label_link",uid:r()};o.nodes.push(k),o.links.push(m)}return o},o.recalculateElements=function(){if(o.removePseudoknots(),o.elements=o.ptToElements(o.pairtable,0,1,o.dotbracket.length),o.circular&&(externalLoop=o.elements.filter(function(e){if("e"==e[0])return!0}),externalLoop.length>0)){eloop=externalLoop[0],nucs=eloop[2].sort(i),prev=nucs[0],hloop=!0,numGreater=0;for(var e=1;e<nucs.length;e++)nucs[e]-prev>1&&(numGreater+=1),prev=nucs[e];1==numGreater?eloop[0]="h":2==numGreater?eloop[0]="i":eloop[0]="m"}return o},o.reassignLinkUids=function(){for(var e,e=0;e<o.links.length;e++)o.links[e].uid=o.links[e].source.uid+o.links[e].target.uid;return o},o.removePseudoknots=function(){return o.pairtable.length>1&&(o.pseudoknotPairs=o.pseudoknotPairs.concat(s.rnaUtilities.removePseudoknotsFromPairtable(o.pairtable))),o},o.addPseudoknots=function(){for(var e=o.pairtable,t=o.pseudoknotPairs,n=0;n<t.length;n++)e[t[n][0]]=t[n][1],e[t[n][1]]=t[n][0];return o.pseudoknotPairs=[],o},o.addName=function(e){return"undefined"==typeof e?(o.name="",o):(o.name=e,o)},o.rnaLength>0&&o.recalculateElements()}function l(e){for(var t={},n=[],l=[],s=0;s<e.molecules.length;s++){var i,u=e.molecules[s];"rna"==u.type?(i=new o(u.seq,u.ss,u.header),i.circularizeExternal=!0,i.elementsToJson().addPositions("nucleotide",u.positions).addLabels().reinforceStems().reinforceLoops()):"protein"==u.type&&(i=new a(u.header,u.size)),i.addUids(u.uids);for(var c=0;c<i.nodes.length;c++)t[i.nodes[c].uid]=i.nodes[c];n.push(i)}for(var s=0;s<e.extraLinks.length;s++)link=e.extraLinks[s],link.source=t[link.source],link.target=t[link.target],link.uid=r(),l.push(link);return{graphs:n,extraLinks:l}}Object.defineProperty(t,"__esModule",{value:!0}),t.ProteinGraph=a,t.RNAGraph=o,t.moleculesToJson=l;var s=n(2),i=function(e,t){return e-t};"undefined"==typeof String.prototype.trim&&(String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$/g,"")})},function(e,t,n){!function(t,n){e.exports=n()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={exports:{},id:r,loaded:!1};return e[r].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t){"use strict";function n(e,t){if(e===t)return!0;if(null===e||null===t)return!1;if(e.length!=t.length)return!1;for(var n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}function r(){var e=this;e.bracketLeft="([{<ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),e.bracketRight=")]}>abcdefghijklmnopqrstuvwxyz".split(""),e.inverseBrackets=function(e){for(var t={},n=0;n<e.length;n++)t[e[n]]=n;return t},e.maximumMatching=function(e){for(var t=e[0],n=0,r=new Array(t+1),a=0;t>=a;a++){r[a]=new Array(t+1);for(var o=a;t>=o;o++)r[a][o]=0}for(var l=0,a=t-n-1;a>0;a--)for(var o=a+n+1;t>=o;o++){l=r[a][o-1];for(var s=o-n-1;s>=a;s--)e[s]===o&&(l=Math.max(l,(s>a?r[a][s-1]:0)+1+(o-s-1>0?r[s+1][o-1]:0)));r[a][o]=l}return l=r[1][t],r},e.backtrackMaximumMatching=function(t,n){var r=Array.apply(null,Array(t.length)).map(function(){return 0});return e.mmBt(t,r,n,1,t.length-1),r},e.mmBt=function(t,n,r,a,o){var l=t[a][o],s=0;if(!(s>o-a-1)){if(t[a][o-1]==l)return void e.mmBt(t,n,r,a,o-1);for(var i=o-s-1;i>=a;i--)if(r[o]===i){var u=i>a?t[a][i-1]:0,c=o-i-1>0?t[i+1][o-1]:0;if(u+c+1==l)return n[i]=o,n[o]=i,i>a&&e.mmBt(t,n,r,a,i-1),void e.mmBt(t,n,r,i+1,o-1)}console.log("FAILED!!!"+a+","+o+": backtracking failed!")}},e.dotbracketToPairtable=function(t){var n=Array.apply(null,new Array(t.length+1)).map(Number.prototype.valueOf,0);n[0]=t.length;for(var r={},a=0;a<e.bracketLeft.length;a++)r[a]=[];for(var o=e.inverseBrackets(e.bracketLeft),l=e.inverseBrackets(e.bracketRight),a=0;a<t.length;a++){var s=t[a],i=a+1;if("."==s||"o"==s)n[i]=0;else if(s in o)r[o[s]].push(i);else{if(!(s in l))throw"Unknown symbol in dotbracket string";var u=r[l[s]].pop();n[i]=u,n[u]=i}}for(var c in r)if(r[c].length>0)throw"Unmatched base at position "+r[c][0];return n},e.insertIntoStack=function(e,t,n){for(var r=0;e[r].length>0&&e[r][e[r].length-1]<n;)r+=1;return e[r].push(n),r},e.deleteFromStack=function(e,t){for(var n=0;0===e[n].length||e[n][e[n].length-1]!=t;)n+=1;return e[n].pop(),n},e.pairtableToDotbracket=function(t){for(var n={},r=0;r<t[0];r++)n[r]=[];for(var r,a={},o="",r=1;r<t[0]+1;r++){if(0!==t[r]&&t[r]in a)throw"Invalid pairtable contains duplicate entries";a[t[r]]=!0,o+=0===t[r]?".":t[r]>r?e.bracketLeft[e.insertIntoStack(n,r,t[r])]:e.bracketRight[e.deleteFromStack(n,r)]}return o},e.findUnmatched=function(t,n,r){for(var a,o=[],l=[],s=n,i=r,a=n;r>=a;a++)0!==t[a]&&(t[a]<n||t[a]>r)&&l.push([a,t[a]]);for(var a=s;i>=a;a++){for(;0===t[a]&&i>=a;)a++;for(r=t[a];t[a]===r;)a++,r--;o=o.concat(e.findUnmatched(t,a,r))}return l.length>0&&o.push(l),o},e.removePseudoknotsFromPairtable=function(t){for(var n=e.maximumMatching(t),r=e.backtrackMaximumMatching(n,t),a=[],o=1;o<t.length;o++)t[o]<o||r[o]!=t[o]&&(a.push([o,t[o]]),t[t[o]]=0,t[o]=0);return a},e.ptToElements=function(t,n,r,a,l){var s=[],i=[r-1],u=[a+1];if(arguments.length<5&&(l=[]),r>a)return[];for(;0===t[r];r++)i.push(r);for(;0===t[a];a--)u.push(a);if(r>a){if(i.push(r),0===n)return[["e",n,i.sort(o)]];for(var c=!1,d=[],p=[],f=0;f<i.length;f++)c?p.push(i[f]):d.push(i[f]),l.indexOf(i[f])>=0&&(c=!0);return c?[["h",n,i.sort(o)]]:[["h",n,i.sort(o)]]}if(t[r]!=a){var h=i,f=r;for(h.push(f);a>=f;){for(s=s.concat(e.ptToElements(t,n,f,t[f],l)),h.push(t[f]),f=t[f]+1;0===t[f]&&a>=f;f++)h.push(f);h.push(f)}return h.pop(),h=h.concat(u),h.length>0&&(0===n?s.push(["e",n,h.sort(o)]):s.push(["m",n,h.sort(o)])),s}if(t[r]===a){i.push(r),u.push(a);var g=i.concat(u);g.length>4&&(0===n?s.push(["e",n,i.concat(u).sort(o)]):s.push(["i",n,i.concat(u).sort(o)]))}for(var k=[];t[r]===a&&a>r;)k.push(r),k.push(a),r+=1,a-=1,n+=1;return i=[r-1],u=[a+1],s.push(["s",n,k.sort(o)]),s.concat(e.ptToElements(t,n,r,a,l))}}function a(e){var t=this;return t.colorsText=e,t.parseRange=function(e){for(var t=e.split(","),n=[],r=0;r<t.length;r++){var a=t[r].split("-");if(1==a.length)n.push(parseInt(a[0]));else if(2==a.length)for(var o=parseInt(a[0]),l=parseInt(a[1]),s=o;l>=s;s++)n.push(s);else console.log("Malformed range (too many dashes):",e)}return n},t.parseColorText=function(e){for(var n=e.split("\n"),r="",a=1,o={colorValues:{"":{}},range:["white","steelblue"]},l=[],s=0;s<n.length;s++)if(">"!=n[s][0])for(var i=n[s].trim().split(/[\s]+/),u=0;u<i.length;u++)if(isNaN(i[u])){if(0===i[u].search("range")){var c=i[u].split("="),d=c[1].split(":");o.range=[d[0],d[1]];continue}if(0==i[u].search("domain")){var p=i[u].split("="),d=p[1].split(":");o.domain=[d[0],d[1]];continue}for(var f=i[u].split(":"),h=t.parseRange(f[0]),g=f[1],k=0;k<h.length;k++)isNaN(g)?o.colorValues[r][h[k]]=g:(o.colorValues[r][h[k]]=+g,l.push(Number(g)))}else o.colorValues[r][a]=Number(i[u]),a+=1,l.push(Number(i[u]));else r=n[s].trim().slice(1),a=1,o.colorValues[r]={};return"domain"in o||(o.domain=[Math.min.apply(null,l),Math.max.apply(null,l)]),t.colorsJson=o,t},t.normalizeColors=function(){var e;for(var n in t.colorsJson){var r=Number.MAX_VALUE,a=Number.MIN_VALUE;for(var o in t.colorsJson.colorValues[n])e=t.colorsJson.colorValues[n][o],"number"==typeof e&&(r>e&&(r=e),e>a&&(a=e));for(o in t.colorsJson.colorValues[n])e=t.colorsJson.colorValues[n][o],"number"==typeof e&&(t.colorsJson.colorValues[n][o]=(e-r)/(a-r))}return t},t.parseColorText(t.colorsText),t}Object.defineProperty(t,"__esModule",{value:!0}),t.arraysEqual=n,t.RNAUtilities=r,t.ColorScheme=a;var o=function(e,t){return e-t};t.rnaUtilities=new r}])})},,function(e,t){"use strict";function n(e){var t,n,r,a=0,o=100,l=100,s=15,i=[],u=[];n=e[0];var c=Array.apply(null,new Array(n+5)).map(Number.prototype.valueOf,0),d=Array.apply(null,new Array(16+Math.floor(n/5))).map(Number.prototype.valueOf,0),p=Array.apply(null,new Array(16+Math.floor(n/5))).map(Number.prototype.valueOf,0),f=0,h=0,g=Math.PI/2,k=function y(e,t,n){var r,a,o,l,s,i,u,k,m,v,b,x,N=2,T=0,A=0,w=Array.apply(null,new Array(3+2*Math.floor((t-e)/5))).map(Number.prototype.valueOf,0);for(r=e-1,t++;e!=t;)if(a=n[e],a&&0!=e){N+=2,o=e,l=a,w[++T]=o,w[++T]=l,e=a+1,s=o,i=l,k=0;do o++,l--,k++;while(n[o]==l&&n[o]>o);if(u=k-2,k>=2&&(c[s+1+u]+=g,c[i-1-u]+=g,c[s]+=g,c[i]+=g,k>2))for(;u>=1;u--)c[s+u]=Math.PI,c[i-u]=Math.PI;p[++h]=k,o<=l&&y(o,l,n)}else e++,N++,A++;for(x=Math.PI*(N-2)/N,w[++T]=t,m=r<0?0:r,v=1;v<=T;v++){for(b=w[v]-m,u=0;u<=b;u++)c[m+u]+=x;if(v>T)break;m=w[++v]}d[++f]=A};k(0,n+1,e),d[f]-=2,r=a,i[0]=o,u[0]=l;var m=[];for(m.push([i[0],u[0]]),t=1;t<n;t++)i[t]=i[t-1]+s*Math.cos(r),u[t]=u[t-1]+s*Math.sin(r),m.push([i[t],u[t]]),r+=Math.PI-c[t+1];return m}Object.defineProperty(t,"__esModule",{value:!0}),t.simpleXyCoordinates=n},,,,,,,function(e,t,n){"use strict";function r(){function e(e,t){function n(e,t,n){var r=(e.range()[1]-e.range()[0])/(e.domain()[1]-e.domain()[0]),a=(t[1]-t[0])*r,o=(n[1]-n[0]-a)/2;return{scaleFactor:r,scale:d3.scale.linear().domain(t).range([n[0]+o,n[1]-o])}}var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=d3.extent(e),o=d3.extent(t),l=30;""!=r&&(o[1]+=l),a[0]-=d.nucleotideRadius+d.rnaEdgePadding,o[0]-=d.nucleotideRadius+d.rnaEdgePadding,a[1]+=d.nucleotideRadius+d.rnaEdgePadding,o[1]+=d.nucleotideRadius+d.rnaEdgePadding;var s,i=a[1]-a[0],p=o[1]-o[0],f=i-d.width,h=p-d.height;f>h?(u=d3.scale.linear().domain(a).range([0,d.width]),s=n(u,o,[0,d.height]),c=s.scale):(c=d3.scale.linear().domain(o).range([0,d.height]),s=n(c,a,[0,d.width]),u=s.scale);u.range()[0]-u.domain()[0],c.range()[0]-c.domain()[0];return"translate("+-(u.domain()[0]*s.scaleFactor-u.range()[0])+","+-(c.domain()[0]*s.scaleFactor-c.range()[0])+")scale("+s.scaleFactor+")"}function t(e,t){var n=e.selectAll(".rna-base").data(t).enter().append("svg:g").attr("transform",function(e){return"translate("+e.x+","+e.y+")"});n.append("svg:circle").attr("r",d.nucleotideRadius).classed("rna-base",!0);if(d.showNucleotideLabels){n.append("svg:text").text(function(e){return e.name}).attr("text-anchor","middle").attr("dominant-baseline","central").classed("nucleotide-label",!0).append("svg:title").text(function(e){return e.struct_name+":"+e.num})}}function n(e,t){var n=e.selectAll(".rnaLabel").data(t).enter().append("svg:g").attr("transform",function(e){return"translate("+e.x+","+e.y+")"});n.append("svg:text").text(function(e){return e.name}).attr("text-anchor","middle").attr("font-weight","bold").attr("dominant-baseline","central").classed("number-label",!0)}function r(e,t){e.append("svg:text").attr("transform","translate("+u.invert(d.width/2)+","+c.invert(d.height)+")").attr("dy",-10).classed("rna-name",!0).text(t)}function o(e,t){var n={},r=[];t=t.filter(function(e){return"correct"==e.linkType||"incorrect"==e.linkType||"extra"==e.linkType}),e.selectAll("[link-type=extra]").remove();for(var a=0;a<t.length;a++)null!==t[a].source&&null!==t[a].target&&(n[t[a].source.uid]=t[a].source,n[t[a].target.uid]=t[a].target,r.push({source:t[a].source.uid,target:t[a].target.uid,linkType:t[a].linkType,extraLinkType:t[a].extraLinkType}));for(var o=d3.ForceEdgeBundling().nodes(n).edges(r).compatibility_threshold(.8).step_size(.2),l=o(),s=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("linear"),a=0;a<l.length;a++){var i=l[a];e.append("path").attr("d",s(i)).style("fill","none").attr("link-type",function(e){return r[a].linkType}).attr("extra-link-type",function(e){return r[a].extraLinkType}).style("stroke-opacity",.4)}}function l(e,t){t=t.filter(function(e){return null!==e.source&&null!==e.target});e.selectAll(".rna-link").data(t).enter().append("svg:line").attr("x1",function(e){return e.source.x}).attr("x2",function(e){return e.target.x}).attr("y1",function(e){return e.source.y}).attr("y2",function(e){return e.target.y}).attr("link-type",function(e){return e.linkType}).attr("extra-link-type",function(e){return e.extraLinkType}).classed("rna-link",!0)}function s(e){e.selectAll(".structure-background-rect").style({stroke:"black","stroke-width":5,fill:"transparent"}),e.selectAll("circle.rna-base").style({stroke:"#ccc","stroke-width":"1px",opacity:1,fill:"white"}),e.selectAll("circle.rna-base.label").style({stroke:"transparent","stroke-width":0,fill:"white"}),e.selectAll("line.link").style({stroke:"#999","stroke-opacity":.8,"stroke-width":2}),e.selectAll("line.rna-link").style({stroke:"#999","stroke-opacity":.8,"stroke-width":2}),e.selectAll(".overlay").style({fill:"transparent"}),e.selectAll(".rna-name").style({"text-anchor":"middle",dy:-10,"font-family":"Tahoma, Geneva, sans-serif","font-size":"8pt"}),e.selectAll('line.rna-link[link-type="backbone"]').style({stroke:"transparent"}),e.selectAll('line.rna-link[link-type="basepair"]').style({stroke:"transparent"}),e.selectAll('line.rna-link[link-type="fake"]').style({stroke:"transparent"}),e.selectAll('line.rna-link[link-type="extra"]').style({stroke:"grey"}),e.selectAll('line.rna-link[extra-link-type="correct"]').style({stroke:"green"}),e.selectAll('line.rna-link[extra-link-type="incorrect"]').style({stroke:"green"}),e.selectAll("path").style({stroke:"grey","stroke-width":2}),e.selectAll('path[extra-link-type="correct"]').style({stroke:"green"}),e.selectAll('path[extra-link-type="incorrect"]').style({stroke:"red"}),e.selectAll("line.basepair").style({stroke:"red"}),e.selectAll("line.intermolecule").style({stroke:"blue"}),e.selectAll("line.chain_chain").style({"stroke-dasharray":"3,3"}),e.selectAll("line.fake").style({stroke:"green"}),e.selectAll(".transparent").style({fill:"transparent","stroke-width":0,"stroke-opacity":0,opacity:0}),e.selectAll(".d3-tip").style({"line-height":1,"font-weight":"bold",padding:"6px",background:"rgba(0, 0, 0, 0.6)",color:"#fff","border-radius":"4px","pointer-events":"none"}),e.selectAll("text.nucleotide-label").style({"font-size":"5.5pt","font-weight":"bold","font-family":"Tahoma, Geneva, sans-serif",color:"rgb(100,100,100)","pointer-events":"none"}),e.selectAll("text.number-label").style({"font-size":"5.5pt","font-weight":"bold","font-family":"Tahoma, Geneva, sans-serif",color:"rgb(100,100,100)","pointer-events":"none"}),e.selectAll("text").style({"pointer-events":"none"}),e.selectAll("g.gnode").style({}),e.selectAll(".brush .extent").style({"fill-opacity":.1,stroke:"#fff","shape-rendering":"crispEdges"}),e.selectAll(".noselect").style({"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"})}function i(i){i.each(function(u){var c=new a.RNAGraph(u.sequence,u.structure,u.name).recalculateElements().elementsToJson().addName(u.name);u.rnaGraph=c;var p=new p,f=naview.naview_xy_coordinates(c.pairtable);c.addPositions("nucleotide",f).reinforceStems().reinforceLoops().addExtraLinks(u.extraLinks).addLabels(d.startNucleotideNumber,d.labelInterval);var h=e(c.nodes.map(function(e){return e.x}),c.nodes.map(function(e){return e.y})),g=d3.select(this).append("g").attr("transform",h),k=c.nodes.filter(function(e){return"nucleotide"==e.nodeType}),m=c.nodes.filter(function(e){return"label"==e.nodeType}),y=c.links;l(g,y),t(g,k),n(g,m),r(g,u.name),d.bundleExternalLinks&&o(g,y),s(i)})}var u,c,d={width:400,height:400,nucleotideRadius:5,rnaEdgePadding:0,labelInterval:0,showNucleotideLabels:!0,startNucleotideNumber:1,bundleExternalLinks:!1};return i.width=function(e){return arguments.length?(d.width=e,i):d.width},i.height=function(e){return arguments.length?(d.height=e,i):d.height},i.showNucleotideLabels=function(e){return arguments.length?(d.showNucleotideLabels=e,i):d.showNucleotideLabels},i.rnaEdgePadding=function(e){return arguments.length?(d.rnaEdgePadding=e,i):d.rnaEdgePadding},i.nucleotideRadius=function(e){return arguments.length?(d.nucleotideRadius=e,i):d.nucleotideRadius},i.labelInterval=function(e){return arguments.length?(d.labelInterval=e,i):d.labelInterval},i.showNucleotideLabels=function(e){return arguments.length?(d.showNucleotideLabels=e,i):d.showNucleotideLabels},i.startNucleotideNumber=function(e){return arguments.length?(d.startNucleotideNumber=e,i):d.startNucleotideNumber},i.bundleExternalLinks=function(e){return arguments.length?(d.bundleExternalLinks=e,i):d.bundleExternalLinks},i}Object.defineProperty(t,"__esModule",{value:!0}),t.rnaPlot=r;var a=(n(4),n(1));n(2);"undefined"==typeof String.prototype.trim&&(String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$/g,"")})}])});